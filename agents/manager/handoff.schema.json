{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "handoff.schema.json",
  "title": "Handoff",
  "description": "Schema for handoff.json and handoff.<agent>.json",
  "type": "object",
  "required": [
    "schemaVersion",
    "handoffId",
    "from",
    "to",
    "step",
    "iteration",
    "input",
    "artifacts",
    "context"
  ],
  "additionalProperties": false,
  "properties": {
    "schemaVersion": { "type": "string", "const": "1.0" },
    "handoffId": {
      "type": "string",
      "description": "Unique identifier for this handoff (GUID)"
    },
    "from": {
      "type": "string",
      "description": "Agent that created this handoff (e.g. manager)"
    },
    "to": { "type": "string", "description": "Subagent to invoke next" },
    "step": { "type": "integer", "description": "Current step number" },
    "iteration": {
      "type": "integer",
      "minimum": 1,
      "description": "Iteration number"
    },
    "input": {
      "type": "string",
      "description": "Input to pass to the receiving agent"
    },
    "artifacts": {
      "type": "object",
      "description": "Paths to key artifacts",
      "additionalProperties": { "type": "string" },
      "properties": {
        "planPath": { "type": "string" },
        "standardsPath": { "type": "string" }
      }
    },
    "context": {
      "type": "object",
      "description": "Relevant context from previous steps",
      "required": ["allowedFiles"],
      "properties": {
        "allowedFiles": {
          "type": "array",
          "description": "Guard rail: only these files may be touched by the receiving agent",
          "items": { "type": "string" }
        },
        "runId": { "type": "string" },
        "planId": { "type": "string" },
        "stepSummary": { "type": "string" },
        "implementorSummary": {
          "type": "string",
          "description": "Deprecated: use stepSummary"
        },
        "filesChanged": { "type": "array", "items": { "type": "string" } },
        "commitSha": { "type": ["string", "null"] },
        "branch": {
          "type": "string",
          "description": "Branch name for this run (e.g. swarm/add-user-auth)"
        },
        "worktreePath": {
          "type": "string",
          "description": "Absolute path to the worktree directory when branching enabled; subagents must operate from this path"
        }
      }
    }
  }
}
